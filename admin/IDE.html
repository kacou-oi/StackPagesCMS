<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDE - Page Creator - StackPages CMS</title>
    <link rel="icon" type="image/x-icon" href="https://stackpages.net/img/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Prism.js for Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Code editor styling - Simple and clean approach */
        #page-html-editor {
            width: 100%;
            height: 100%;
            padding: 1rem;
            margin: 0;
            border: 0;
            background: #1e1e1e;
            color: #d4d4d4;
            caret-color: #ffffff;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
            overflow: auto;
            tab-size: 4;
        }

        #page-html-editor::selection {
            background: rgba(38, 79, 120, 0.6);
        }

        #page-html-editor::placeholder {
            color: #6a737d;
        }

        #page-html-editor::placeholder {
            color: #6a737d;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <a href="/admin/dashboard.html" class="text-slate-400 hover:text-orange-500 transition"
                title="Retour au dashboard">
                <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <div>
                <h1 class="text-xl font-bold text-slate-800">Page Creator IDE</h1>
                <p class="text-sm text-slate-500" id="page-status">Nouvelle page</p>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <button onclick="previewPageNewTab()"
                class="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg font-medium transition flex items-center gap-2">
                <i class="fas fa-external-link-alt"></i> Aperçu
            </button>
            <button onclick="savePage('draft')"
                class="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg font-medium transition flex items-center gap-2">
                <i class="far fa-save"></i> Brouillon
            </button>
            <button onclick="savePage('published')"
                class="px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white rounded-lg font-medium transition shadow-md hover:shadow-lg flex items-center gap-2">
                <i class="fas fa-check"></i> Publier
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-hidden flex">
        <!-- Left Sidebar - Form -->
        <aside class="w-80 bg-white border-r border-slate-200 overflow-y-auto p-6">
            <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fas fa-cog text-orange-500"></i>
                Paramètres de la Page
            </h2>

            <form id="page-creator-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1.5">
                        Titre de la Page <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="page-title" required placeholder="Ex: À propos de nous"
                        class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition text-sm">
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1.5">
                        Slug URL
                    </label>
                    <input type="text" id="page-slug" readonly placeholder="a-propos-de-nous"
                        class="w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-lg text-slate-600 cursor-not-allowed text-sm">
                    <p class="text-xs text-slate-500 mt-1">Généré automatiquement</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1.5">
                        Meta Description
                    </label>
                    <textarea id="page-meta-desc" rows="3"
                        placeholder="Description courte pour les moteurs de recherche..."
                        class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition resize-none text-sm"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1.5">
                        Meta Keywords
                    </label>
                    <input type="text" id="page-meta-keywords" placeholder="mot-clé1, mot-clé2, mot-clé3"
                        class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition text-sm">
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1.5">
                        Image Thumbnail (URL)
                    </label>
                    <input type="url" id="page-thumbnail" placeholder="https://example.com/image.jpg"
                        class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition text-sm">
                </div>

                <div class="pt-4 border-t border-slate-200">
                    <button type="button" onclick="clearPageForm()"
                        class="w-full px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg font-medium transition flex items-center justify-center gap-2">
                        <i class="fas fa-trash-alt"></i> Réinitialiser le formulaire
                    </button>
                </div>

                <div id="page-save-status" class="text-sm"></div>
            </form>
        </aside>

        <!-- Right Panel - Code Editor -->
        <div class="flex-1 flex flex-col bg-white">
            <!-- Code Editor Header -->
            <div class="px-6 py-3 border-b border-slate-700 bg-[#252526] flex justify-between items-center">
                <h3 class="font-semibold text-slate-200 flex items-center gap-2">
                    <i class="fas fa-code text-orange-500"></i>
                    Éditeur HTML
                </h3>

                <!-- Gemini Branding -->
                <div class="flex items-center gap-3 bg-[#1e1e1e] px-4 py-1.5 rounded-full border border-slate-700">
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD3klEQVR4nO2a208UVxzHD8YLTaw+U30E3KLUCmhTEbdi4y1q01Rq0VZqpHuZyy67K3ub3TkoxoSoGIw+9H/o0uibjQHa9PLSB21MTGB3Zm8DOzO76FKf+TUHC7EI4gjszkn6+Qs+s/md336/Zwah/1mc245CbMBe+AHRyi17odjv0IuIRnAbrO936tPXnPr09zZYh2hjgM9vve7MQx+jQx+rv4do4zqjHyTyV1kdLjk1K6KNPkbzEPleVoceVnMj2rjKavdm5DkNoqz2I6KJG570O5cZ/TmRFzkNBC43xfOjGxAt9DL62Tl5XoWQS4Vu98RpRAs9nPrzy/J+lwpeV24Y0QBm1H3z5X3uHHjcOeC6lBZkZjCGNSKn/b6QvKsrB4x74heEoAKZFZHT7YvJs10T4PRMgN2jXEBmBLNabZjLFV8nb/OOwwWv8neHV7EgMxGwTW4O8+rjpeQ7veNw3jcO33iVR2f5/CZkBnCHXClwuZE3lT/nU+Driwp85VOGOrBcWV55Rt0o8OpPRuXbLypwujsLX/izI22BxObyyHO6xcjYzJc/5c/C5/4snAxk/joazNaWeFXqdhIPliv/WSADxwMZOBbIFI+GMt+t+oq9xGvWKKv9sdSqNCQfzMCRYBoOhdLwaTD1W2so1bLih/Qyq59ZKB6sqHwoBa3hFFjDKWgJJ0f2CXK71eghJzXwhj2/5ZpDb32R57V7/0mVpZGHZiEJHwtJ+CgiPd8tyHcbI7KnQYi37gynt9Thx+tfEb/jKAzesuef3nTmYbYGzpWRssnLsDsiQ2NUhl1RCT4QJdghSlCHE7BNjD+tFROxuQcYcBRi/U59kgZ5C05ADY5PVveMxV4dIQxrr9i0ql5G2485zSVy2uCKbhvj8lP1USm2Iyq53sfSfks4WWXFw2sNnQvSpEgZ8blzQyWTj0gPPhSltgXnfTlwXWozicSrJi/II01Cci9aXaCCROJOr1JcQflnTYJ8vqRd4dvuTA1JlcuWF+SHu/BYNSoHbYy6sd2Xvf+28nsi0vAePFreWE0i8Sl/dsj4Ly89qDbLVcsRPr+JpEojY7O3+8m7yEycCKarjwUzz5YeG3mqKSJtQ2bkcCDdudSqfLFtTAtUHAymfn3dnjf1tQrhk1CyebF/2IZowtwXW7OQPL9APBhCtNAcks/MD2YNEelLRAtWLFfOlJGXUqVpdv6bMtOk/s3z9WJiENFGY0T2zJaR7aJE3yumnVH5wGyTImUE0UY9Ht06VwPDySpEG422P9fV4fi0BcenDddAs2ARE8VaMUHnpwYEcvVRg8fo/dgDlYB/AK0IWrcIdgHFAAAAAElFTkSuQmCC"
                        alt="gemini-ai" class="w-6 h-6 animate-pulse">
                    <span class="font-bold text-slate-200 text-sm">Powered by Google Gemini</span>
                    <button onclick="openGeminiConfig()" class="ml-2 text-slate-400 hover:text-white transition"
                        title="Configurer l'API Gemini">
                        <i class="fas fa-cog text-lg hover:rotate-90 transition-transform duration-500"></i>
                    </button>
                </div>

                <div class="flex items-center gap-3">
                    <span id="html-char-count" class="text-xs text-slate-400 mr-2">0 caractères</span>
                    <button onclick="copyHtmlCode()"
                        class="px-3 py-1.5 bg-[#333333] border border-slate-600 rounded-md text-sm text-slate-200 hover:bg-[#444444] transition flex items-center gap-2">
                        <i class="fas fa-copy"></i> Copier
                    </button>
                </div>
            </div>
            <!-- Code Editor -->
            <div class="flex-1 bg-[#1e1e1e] overflow-hidden">
                <textarea id="page-html-editor" placeholder="Collez votre code HTML ici..." spellcheck="false"
                    autocomplete="off" autocorrect="off" autocapitalize="off"></textarea>
            </div>

            <div class="px-6 py-3 border-t border-slate-700 bg-[#252526] flex items-center justify-between">
                <span class="text-xs text-slate-400">
                    <i class="fas fa-keyboard text-orange-400 mr-1"></i>
                    Tapez dans l'éditeur ci-dessus - La coloration s'actualise automatiquement
                </span>
                <div class="flex items-center gap-4">
                    <span id="page-status-badge" class="text-xs px-2 py-1 rounded bg-slate-700 text-slate-300">
                        <i class="fas fa-circle text-green-500 mr-1" style="font-size: 6px;"></i>
                        Prêt
                    </span>
                    <span id="html-char-count" class="text-xs text-slate-400">0 caractères</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Preview -->
    <div id="preview-modal"
        class="fixed inset-0 z-50 hidden bg-black/50 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden">
            <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <h3 id="modal-title" class="font-bold text-lg text-slate-800 truncate pr-4">Aperçu de la page</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600 transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="modal-content" class="p-8 overflow-y-auto prose prose-orange max-w-none">
                <!-- Content -->
            </div>
        </div>
    </div>

    <!-- Gemini Config Modal -->
    <div id="gemini-modal"
        class="fixed inset-0 z-50 hidden bg-black/50 backdrop-blur-sm flex items-center justify-center p-4">
        <div
            class="bg-[#1e1e1e] rounded-xl shadow-2xl w-full max-w-md border border-slate-700 transform transition-all scale-100">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-white flex items-center gap-2">
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD3klEQVR4nO2a208UVxzHD8YLTaw+U30E3KLUCmhTEbdi4y1q01Rq0VZqpHuZyy67K3ub3TkoxoSoGIw+9H/o0uibjQHa9PLSB21MTGB3Zm8DOzO76FKf+TUHC7EI4gjszkn6+Qs+s/md336/Zwah/1mc245CbMBe+AHRyi17odjv0IuIRnAbrO936tPXnPr09zZYh2hjgM9vve7MQx+jQx+rv4do4zqjHyTyV1kdLjk1K6KNPkbzEPleVoceVnMj2rjKavdm5DkNoqz2I6KJG570O5cZ/TmRFzkNBC43xfOjGxAt9DL62Tl5XoWQS4Vu98RpRAs9nPrzy/J+lwpeV24Y0QBm1H3z5X3uHHjcOeC6lBZkZjCGNSKn/b6QvKsrB4x74heEoAKZFZHT7YvJs10T4PRMgN2jXEBmBLNabZjLFV8nb/OOwwWv8neHV7EgMxGwTW4O8+rjpeQ7veNw3jcO33iVR2f5/CZkBnCHXClwuZE3lT/nU+Driwp85VOGOrBcWV55Rt0o8OpPRuXbLypwujsLX/izI22BxObyyHO6xcjYzJc/5c/C5/4snAxk/joazNaWeFXqdhIPliv/WSADxwMZOBbIFI+GMt+t+oq9xGvWKKv9sdSqNCQfzMCRYBoOhdLwaTD1W2so1bLih/Qyq59ZKB6sqHwoBa3hFFjDKWgJJ0f2CXK71eghJzXwhj2/5ZpDb32R57V7/0mVpZGHZiEJHwtJ+CgiPd8tyHcbI7KnQYi37gynt9Thx+tfEb/jKAzesuef3nTmYbYGzpWRssnLsDsiQ2NUhl1RCT4QJdghSlCHE7BNjD+tFROxuQcYcBRi/U59kgZ5C05ADY5PVveMxV4dIQxrr9i0ql5G2485zSVy2uCKbhvj8lP1USm2Iyq53sfSfks4WWXFw2sNnQvSpEgZ8blzQyWTj0gPPhSltgXnfTlwXWozicSrJi/II01Cci9aXaCCROJOr1JcQflnTYJ8vqRd4dvuTA1JlcuWF+SHu/BYNSoHbYy6sd2Xvf+28nsi0vAePFreWE0i8Sl/dsj4Ly89qDbLVcsRPr+JpEojY7O3+8m7yEycCKarjwUzz5YeG3mqKSJtQ2bkcCDdudSqfLFtTAtUHAymfn3dnjf1tQrhk1CyebF/2IZowtwXW7OQPL9APBhCtNAcks/MD2YNEelLRAtWLFfOlJGXUqVpdv6bMtOk/s3z9WJiENFGY0T2zJaR7aJE3yumnVH5wGyTImUE0UY9Ht06VwPDySpEG422P9fV4fi0BcenDddAs2ARE8VaMUHnpwYEcvVRg8fo/dgDlYB/AK0IWrcIdgHFAAAAAElFTkSuQmCC"
                            alt="gemini-ai" class="w-6 h-6 animate-pulse">
                        Configuration Gemini
                    </h3>
                    <button onclick="closeGeminiConfig()" class="text-slate-400 hover:text-white transition">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div class="space-y-5">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Clé API Gemini</label>
                        <div class="relative">
                            <input type="password" id="gemini-api-key" placeholder="Collez votre clé API ici..."
                                class="w-full pl-10 pr-4 py-2.5 bg-[#252526] border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition placeholder-slate-500">
                            <i class="fas fa-key absolute left-3 top-3 text-slate-500"></i>
                        </div>
                    </div>

                    <div class="bg-[#252526] rounded-lg p-4 border border-slate-700">
                        <p class="text-sm text-slate-300 mb-2 font-medium">Comment obtenir une clé :</p>
                        <ol class="list-decimal list-inside space-y-1.5 text-sm text-slate-400 ml-1">
                            <li>Allez sur <a href="https://makersuite.google.com/app/apikey" target="_blank"
                                    class="text-blue-400 hover:text-blue-300 hover:underline">Google AI Studio</a></li>
                            <li>Créez une clé API gratuite</li>
                            <li>Copiez et collez-la ci-dessus</li>
                        </ol>
                    </div>

                    <div class="pt-1">
                        <a href="https://www.youtube.com/watch?v=example" target="_blank"
                            class="flex items-center gap-2 text-red-400 hover:text-red-300 text-sm font-medium group">
                            <div
                                class="w-6 h-6 bg-red-500/10 rounded-full flex items-center justify-center group-hover:bg-red-500/20 transition">
                                <i class="fab fa-youtube"></i>
                            </div>
                            VIDEO TUTO : Comment configurer Gemini
                        </a>
                    </div>

                    <button onclick="saveGeminiConfig()"
                        class="w-full py-2.5 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white rounded-lg font-bold transition shadow-lg shadow-blue-500/20 flex items-center justify-center gap-2">
                        <i class="fas fa-save"></i>
                        Sauvegarder la configuration
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="./../core/admin.js"></script>
    <script>
        // Open preview in new tab
        function previewPageNewTab() {
            const title = document.getElementById('page-title')?.value.trim();
            const htmlContent = document.getElementById('page-html-editor')?.value.trim();
            const thumbnail = document.getElementById('page-thumbnail')?.value.trim();
            const metaDesc = document.getElementById('page-meta-desc')?.value.trim();
            const metaKeywords = document.getElementById('page-meta-keywords')?.value.trim();

            if (!title || !htmlContent) {
                alert('Veuillez remplir au moins le titre et le contenu HTML');
                return;
            }

            // Create preview HTML - minimal interference with user's code
            let previewHtml = `<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title}</title>
    ${metaDesc ? `<meta name="description" content="${metaDesc}">` : ''}
    ${metaKeywords ? `<meta name="keywords" content="${metaKeywords}">` : ''}
    <style>
        /* Reset minimal pour éviter les interférences */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
${htmlContent}
</body>
</html>`;

            // Open in new tab
            const newTab = window.open('', '_blank');
            newTab.document.write(previewHtml);
            newTab.document.close();
        }

        // Gemini Configuration Functions
        function openGeminiConfig() {
            const modal = document.getElementById('gemini-modal');
            const apiKeyInput = document.getElementById('gemini-api-key');

            if (modal) {
                modal.classList.remove('hidden');
                // Load saved key
                const savedKey = localStorage.getItem('stackpages_gemini_key');
                if (savedKey && apiKeyInput) {
                    apiKeyInput.value = savedKey;
                }
            }
        }

        function closeGeminiConfig() {
            const modal = document.getElementById('gemini-modal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        function saveGeminiConfig() {
            const apiKeyInput = document.getElementById('gemini-api-key');
            if (apiKeyInput) {
                const key = apiKeyInput.value.trim();
                if (key) {
                    localStorage.setItem('stackpages_gemini_key', key);

                    // Show success feedback
                    const btn = document.querySelector('#gemini-modal button[onclick="saveGeminiConfig()"]');
                    const originalContent = btn.innerHTML;

                    btn.innerHTML = '<i class="fas fa-check"></i> Sauvegardé !';
                    btn.classList.remove('from-blue-600', 'to-blue-500');
                    btn.classList.add('from-green-600', 'to-green-500');

                    setTimeout(() => {
                        closeGeminiConfig();
                        // Reset button style after closing
                        setTimeout(() => {
                            btn.innerHTML = originalContent;
                            btn.classList.add('from-blue-600', 'to-blue-500');
                            btn.classList.remove('from-green-600', 'to-green-500');
                        }, 500);
                    }, 1000);
                } else {
                    alert('Veuillez entrer une clé API valide');
                }
            }
        }

        // Close modal when clicking outside
        document.getElementById('gemini-modal')?.addEventListener('click', function (e) {
            if (e.target === this) {
                closeGeminiConfig();
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAuth();

            // Initialize editor event listeners
            const editor = document.getElementById('page-html-editor');
            const charCount = document.getElementById('html-char-count');
            const statusBadge = document.getElementById('page-status-badge');

            if (editor) {
                // Update character count and status on input
                editor.addEventListener('input', function () {
                    if (charCount) {
                        charCount.textContent = `${this.value.length} caractères`;
                    }
                    if (statusBadge && this.value.length > 0) {
                        statusBadge.innerHTML = '<i class=\"fas fa-circle text-yellow-500 mr-1\" style=\"font-size: 6px;\"></i> Modifié';
                        statusBadge.className = 'text-xs px-2 py-1 rounded bg-yellow-900 text-yellow-300';
                    }
                });

                // Initial count
                if (editor.value && charCount) {
                    charCount.textContent = `${editor.value.length} caractères`;
                }
            }

            // Check if editing existing page
            const urlParams = new URLSearchParams(window.location.search);
            const pageSlug = urlParams.get('page');

            if (pageSlug) {
                loadPageBySlug(pageSlug);
            }
        });

        // Load page by slug from localStorage
        function loadPageBySlug(slug) {
            let pages = [];
            try {
                const stored = localStorage.getItem('stackpages_custom_pages');
                if (stored) {
                    pages = JSON.parse(stored);
                }
            } catch (e) {
                console.error('Error loading pages:', e);
                return;
            }

            const page = pages.find(p => p.slug === slug);

            if (!page) {
                console.error('Page not found:', slug);
                return;
            }

            // Populate form fields
            document.getElementById('page-title').value = page.title || '';
            document.getElementById('page-slug').value = page.slug || '';
            document.getElementById('page-meta-desc').value = page.metaDesc || '';
            document.getElementById('page-meta-keywords').value = page.metaKeywords || '';
            document.getElementById('page-thumbnail').value = page.thumbnail || '';
            document.getElementById('page-html-editor').value = page.htmlContent || '';

            // Update status
            const statusText = page.status === 'draft' ? 'Édition: ' + page.title + ' (Brouillon)' : 'Édition: ' + page.title;
            document.getElementById('page-status').textContent = statusText;

            // Update status badge
            const statusBadge = document.getElementById('page-status-badge');
            if (statusBadge && page.status === 'draft') {
                statusBadge.innerHTML = '<i class="fas fa-circle text-orange-500 mr-1" style="font-size: 6px;"></i> Brouillon';
                statusBadge.className = 'text-xs px-2 py-1 rounded bg-orange-900 text-orange-300';
            } else if (statusBadge) {
                statusBadge.innerHTML = '<i class="fas fa-circle text-green-500 mr-1" style="font-size: 6px;"></i> Publié';
                statusBadge.className = 'text-xs px-2 py-1 rounded bg-green-900 text-green-300';
            }

            // Update character count
            const charCount = document.getElementById('html-char-count');
            if (charCount && page.htmlContent) {
                charCount.textContent = `${page.htmlContent.length} caractères`;
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('preview-modal').classList.add('hidden');
            const content = document.getElementById('modal-content');
            content.innerHTML = '';
        }
    </script>
</body>

</html>